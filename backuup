import pandas as pd
import re

df = pd.read_csv(
    "data/sales_data.txt",
    sep="|",
    encoding="latin1",          # handles non-utf encoding
    engine="python",
    on_bad_lines="skip"         # skips rows with extra/missing fields
)
print("Raw Data Shape:", df.shape)
# Drop empty rows
df = df.dropna(how="all")

# Clean column names
df.columns = df.columns.str.strip()

# Fix commas in Product Name
df["ProductName"] = df["ProductName"].astype(str).str.replace(",", " ", regex=False)

# Fixed Numeric formatting
df["Quantity"] = (
    df["Quantity"]
    .astype(str)
    .str.replace(",", "", regex=False)
)

df["UnitPrice"] = (
    df["UnitPrice"]
    .astype(str)
    .str.replace(",", "", regex=False)
)
df["Quantity"] = pd.to_numeric(df["Quantity"], errors="coerce")
df["UnitPrice"] = pd.to_numeric(df["UnitPrice"], errors="coerce")

# Remove INVALID records Missing CustomerID OR Region
df = df.dropna(subset=["CustomerID", "Region"])

# Remove Quantity ≤ 0
df = df[df["Quantity"] > 0]

# remove UnitPrice ≤ 0
df = df[df["UnitPrice"] > 0]

# Remove TransactionID does NOT start with 'T'
df = df[df["TransactionID"].astype(str).str.match(r"^T")]

# Reset Index
df = df.reset_index(drop=True)

print("Cleaned Data Shape:", df.shape)

#Saved cleaned data
df.to_csv("data/sales_data_cleaned.csv", index=False)





